# ClawFactory Subdomain Router
# Routes *.local subdomains to the correct instance
#
# Usage: docker compose -f router/docker-compose.yml up -d
#
# Add to /etc/hosts:
#   127.0.0.1 sandy.local testbot.local newbot.local
#
# Then access:
#   http://sandy.local:8080/controller
#   http://testbot.local:18789

services:
  router:
    image: nginx:alpine
    container_name: clawfactory-router
    restart: unless-stopped
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - "127.0.0.1:8080:8080"    # Controller routing
      - "127.0.0.1:18789:80"     # Gateway routing
    networks:
      - clawfactory-shared
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/health"]
      interval: 30s
      timeout: 5s
      retries: 3

networks:
  clawfactory-shared:
    name: clawfactory-shared
    driver: bridge
